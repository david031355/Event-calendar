<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 砖转 - 砖转 住转</title>
    <!-- 砖砖 驻 Rubik 专 砖  -->
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #8D6E63; /*  -  */
            --secondary-color: #D7CCC8;
            --accent-color: #5D4037;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-secondary: #666666;
            --border-radius: 12px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Rubik', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* 转专转 专砖转 */
        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--accent-color);
            margin: 0 0 10px 0;
            font-size: 2rem;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* --- 专 驻砖 住 砖 --- */
        .filters-container {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 2;
            min-width: 200px;
        }

        .date-input-wrapper {
            flex: 1;
            min-width: 150px;
        }

        .input-style {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-family: 'Rubik', sans-serif;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            box-sizing: border-box;
            outline: none;
            background-color: white;
        }

        .input-style:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(141, 110, 99, 0.15);
        }
        
        /* 注爪  砖 转专 */
        input[type="date"] {
            appearance: none;
            -webkit-appearance: none;
            color: var(--text-secondary);
        }

        /* 注爪 专砖转 专注 */
        .events-list {
            display: grid;
            gap: 15px;
        }

        /* 专住 专注 */
        .event-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 20px;
            display: grid;
            grid-template-columns: 100px 1fr auto; /* 转专 | 驻专 | 注 */
            gap: 20px;
            align-items: center;
            transition: transform 0.2s;
            border-right: 5px solid var(--primary-color);
        }

        .event-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* 专 转专 */
        .date-box {
            text-align: center;
            background-color: #fff8f6;
            padding: 10px;
            border-radius: 8px;
            color: var(--accent-color);
            border: 1px solid #efebe9;
        }

        .date-day {
            font-size: 1.2rem;
            font-weight: 700;
            display: block;
        }

        .date-full {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* 驻专 专注 */
        .info-box h3 {
            margin: 0 0 5px 0;
            font-size: 1.3rem;
            color: var(--text-main);
        }

        .info-location, .info-orchestra {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-top: 5px;
        }
        
        .icon { opacity: 0.7; }

        /* 专 注 (祝 转 砖注) */
        .vaad-badge {
            text-align: center;
            font-weight: 500;
            color: var(--accent-color);
            font-size: 1rem;
            background: #EFEBE9; /* 专拽注  专  */
            padding: 6px 14px;
            border-radius: 20px;
            white-space: nowrap;
            border: 1px solid #D7CCC8;
            min-width: 80px;
        }

        /* 爪 注 砖 */
        .loading, .error, .no-results {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--text-secondary);
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .error { color: #d32f2f; border: 1px solid #ffcdd2; }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 10px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- 专住驻住转  --- */
        @media (max-width: 768px) {
            body { padding: 15px; }
            
            h1 { font-size: 1.6rem; }

            .filters-container {
                flex-direction: column;
                gap: 10px;
            }

            .event-card {
                grid-template-columns: 1fr; /* 专  */
                gap: 12px;
                text-align: center;
                padding: 15px;
                border-right: none;
                border-top: 5px solid var(--primary-color);
                position: relative; /*  驻砖专 拽  砖 注 */
            }

            /* , 注 驻注 驻 砖转 注  */
            .vaad-badge {
                position: absolute;
                top: 15px;
                left: 15px;
                font-size: 0.85rem;
                padding: 4px 10px;
                background: #fff3e0;
                border-color: #ffe0b2;
            }

            .date-box {
                display: flex;
                justify-content: center;
                gap: 10px;
                align-items: baseline;
                background: none;
                border: none;
                padding: 0;
                margin-top: 20px; /* 专  转 注 */
            }

            .info-box h3 {
                font-size: 1.4rem;
            }

            .info-location, .info-orchestra {
                justify-content: center;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>转转 砖转 砖转 住转 </h1>
        <div class="subtitle"> 专注 注</div>
    </header>

    <!-- 专 住 砖 -->
    <div class="filters-container">
        <div class="search-input-wrapper">
            <input type="text" id="searchInput" class="input-style" placeholder=" 驻砖 (砖, 拽, 注)...">
        </div>
        <div class="date-input-wrapper">
            <input type="date" id="dateInput" class="input-style" aria-label="住 驻 转专">
        </div>
    </div>

    <!-- 专 转 -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div>注 转...</div>
    </div>
    
    <div id="error" class="error" style="display: none;"></div>
    
    <div id="eventsList" class="events-list">
        <!--  住 专注 转 -->
    </div>
    
    <div id="noResults" class="no-results" style="display: none;">
         爪 专注 转 驻砖 砖 
    </div>
</div>

<script>
    // 拽砖专  (CSV)
    const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1kU7TYAae8W0qojrbC0En8VwDHed5JM8RvmQDniIbWXk/gviz/tq?tqx=out:csv&sheet=注 转转 - 住转';

    let allEvents = []; // 砖专转  专注

    document.addEventListener('DOMContentLoaded', init);

    async function init() {
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const searchInput = document.getElementById('searchInput');
        const dateInput = document.getElementById('dateInput');

        try {
            const response = await fetch(SHEET_URL);
            if (!response.ok) throw new Error('砖转 专砖转 注转 转');
            
            const csvText = await response.text();
            let rawEvents = parseCSV(csvText);

            // 住专转 砖专转 转专转
            if (rawEvents.length > 0 && (rawEvents[0][0].includes('转专') || rawEvents[0][1].includes(''))) {
                rawEvents.shift();
            }

            // 注  专砖
            allEvents = processEvents(rawEvents);

            loadingEl.style.display = 'none';
            renderEvents(allEvents);

            // 驻注转  砖 驻砖  转专
            searchInput.addEventListener('input', runFilters);
            dateInput.addEventListener('change', runFilters);

        } catch (err) {
            console.error(err);
            loadingEl.style.display = 'none';
            errorEl.textContent = '驻住!  爪 注 转 转.   砖住驻转 转 注 "转专 注" (注 G) .';
            errorEl.style.display = 'block';
        }
    }

    /**
     * 注, 住 注专, 
     */
    function processEvents(rows) {
        const today = new Date();
        today.setHours(0, 0, 0, 0); 

        // 1. 专 拽
        const eventsWithDates = rows.map(row => {
            const dateStr = row[6] || ''; 
            const dateObj = parseDateString(dateStr);
            return { originalRow: row, dateObj: dateObj };
        });

        // 2. 住 专注 注专 (砖专 专拽 注转 + )
        const futureEvents = eventsWithDates.filter(item => {
            if (!item.dateObj) return true; 
            return item.dateObj >= today;
        });

        // 3. 
        futureEvents.sort((a, b) => {
            if (!a.dateObj) return 1;
            if (!b.dateObj) return -1;
            return a.dateObj - b.dateObj;
        });

        return futureEvents;
    }

    /**
     * 驻拽爪转 住 专砖转 - 砖转 拽住 转专
     */
    function runFilters() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const filterDateVal = document.getElementById('dateInput').value;
        
        let filterDateObj = null;
        if (filterDateVal) {
            filterDateObj = new Date(filterDateVal);
            filterDateObj.setHours(0,0,0,0);
        }

        const filtered = allEvents.filter(item => {
            const row = item.originalRow;
            const eventDateObj = item.dateObj;
            
            // 1. 拽转 拽住
            const rowText = row.join(' ').toLowerCase();
            const textMatch = rowText.includes(searchTerm);
            
            // 2. 拽转 转专 ( 专)
            // 爪 专注  转专 专 
            let dateMatch = true;
            if (filterDateObj && eventDateObj) {
                dateMatch = eventDateObj >= filterDateObj;
            }

            return textMatch && dateMatch;
        });

        // 驻 爪 " 转爪转"
        const noResults = document.getElementById('noResults');
        if (filtered.length === 0) {
            noResults.style.display = 'block';
            if (filterDateVal && !searchTerm) {
                noResults.textContent = " 专注  转专 砖专 ";
            } else {
                noResults.textContent = " 爪 专注 转 驻砖 ";
            }
        } else {
            noResults.style.display = 'none';
        }

        renderEvents(filtered);
    }

    function parseDateString(dateStr) {
        if (!dateStr) return null;
        dateStr = dateStr.trim();
        const parts = dateStr.split(/[/\.]/); // 转  -拽  -住砖
        
        if (parts.length === 3) {
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1;
            const year = parseInt(parts[2], 10);
            if (year > 2000 && month >= 0 && month <= 11 && day >= 1 && day <= 31) {
                return new Date(year, month, day);
            }
        }
        return null;
    }

    function parseCSV(text) {
        const rows = [];
        let currentRow = [];
        let currentCell = '';
        let insideQuotes = false;
        text = text.replace(/\r/g, '');

        for (let i = 0; i < text.length; i++) {
            const char = text[i];
            const nextChar = text[i + 1];
            if (char === '"') {
                if (insideQuotes && nextChar === '"') {
                    currentCell += '"'; i++;
                } else {
                    insideQuotes = !insideQuotes;
                }
            } else if (char === ',' && !insideQuotes) {
                currentRow.push(currentCell.trim()); currentCell = '';
            } else if (char === '\n' && !insideQuotes) {
                currentRow.push(currentCell.trim());
                if (currentRow.length > 1) rows.push(currentRow);
                currentRow = []; currentCell = '';
            } else {
                currentCell += char;
            }
        }
        if (currentCell || currentRow.length > 0) {
            currentRow.push(currentCell.trim());
            if (currentRow.length > 1) rows.push(currentRow);
        }
        return rows;
    }

    function renderEvents(eventsWrapper) {
        const container = document.getElementById('eventsList');
        container.innerHTML = '';
        
        eventsWrapper.forEach(item => {
            const row = item.originalRow;
            if (row.length < 4) return; 

            const date = row[0] || '';
            const day = row[1] || '';
            const vaad = row[2] || ''; // 注 C 注转 专转 "注"
            const title = row[3] || '专注';
            const location = row[4] || '';
            const orchestra = row[5] || '';

            const card = document.createElement('div');
            card.className = 'event-card';
            
            // 拽  砖 转 "注"  砖 爪 转 专拽
            const vaadHtml = vaad ? `<div class="vaad-badge">${vaad}</div>` : '';

            card.innerHTML = `
                <div class="date-box">
                    <span class="date-day">${day}</span>
                    <span class="date-full">${date}</span>
                </div>
                
                <div class="info-box">
                    <h3>${title}</h3>
                    ${location ? `<div class="info-location"><span class="icon"></span> ${location}</div>` : ''}
                    ${orchestra ? `<div class="info-orchestra"><span class="icon"></span> ${orchestra}</div>` : ''}
                </div>
                
                ${vaadHtml}
            `;
            container.appendChild(card);
        });
    }
</script>

</body>
</html>
